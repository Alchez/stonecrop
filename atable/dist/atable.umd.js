!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["@sedum/aform"]=t(e.Vue)}(this,(function(e){"use strict";var t,o=new Uint8Array(16);function n(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(o)}var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function r(e){return"string"==typeof e&&a.test(e)}for(var l=[],i=0;i<256;++i)l.push((i+256).toString(16).substr(1));function d(e,t,o){var a=(e=e||{}).random||(e.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){o=o||0;for(var i=0;i<16;++i)t[o+i]=a[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase();if(!r(o))throw TypeError("Stringified UUID is invalid");return o}(a)}class c{constructor(t,o=[],n=[],a={},r,l){this.id=void 0===t?d():t,this.rows=n,this.columns=e.reactive(o),this.config=e.reactive(a),this.table=void 0===r?e.reactive(this.createTableObject(n)):r,this.display=this.createDisplayObject(l),this.modal=e.reactive({visible:!1,rowIndex:void 0,colIndex:void 0,event:void 0})}createTableObject(e){let t={};return this.columns.forEach(((o,n)=>{e.forEach(((o,a)=>{t[n+":"+a]=e[a][this.columns[n].name]}))})),t}createDisplayObject(t){let o={};return o=!0===this.config.treeView?{modified:e.ref(!1),open:e.ref(!1),isParent:!1,isRoot:!1}:{modified:!1},void 0!==t&&t.hasOwnProperty("0:0")||(void 0!==t&&t.hasOwnProperty("default")&&(o=t.default),t={},Object.keys(this.table).forEach((e=>{t[e]=o}))),t}get zeroColumn(){return!(!this.config.numberedRows&&!this.config.treeView)}get numberedRowWidth(){e.computed((()=>String(Math.ceil(this.rows.length/100)+1)+"ch"))}cellData(e,t){return this.table[t+":"+e]}setCellData(e,t,o){return this.table[t+":"+e]!==o&&(this.display[t+":"+e].modified=!0),this.table[t+":"+e]=o,this.table[t+":"+e]}}const s=e.defineComponent({name:"ARow",props:{row:{type:Object,required:!0,default:()=>({})},rowIndex:{type:Number,required:!0,default:0},isParent:{type:Boolean,default:!1},tableid:{type:String,required:!0,default:()=>{}}},setup:(t,o)=>({open:e.ref(!1),TableData:e.inject(t.tableid),getRowExpandSymbol:function(){return this.isParent&&!this.open?"+":this.isParent&&this.open?"-":""},toggleRowExpand:function(e,t){this.open?this.$parent.toggleRowCollapseDeep(e,t):this.$parent.toggleRowExpand(e,t),this.open=!this.open}})});s.render=function(t,o,n,a,r,l){return e.withDirectives((e.openBlock(),e.createBlock("tr",null,[t.TableData.config.numberedRows?(e.openBlock(),e.createBlock("td",{key:0,style:{width:"TableData.numberedRowWidth","text-align":"center","background-color":"var(--brand-color)",color:"var(--header-text-color)","font-weight":"bold","border-color":"var(--header-border-color)","user-select":"none"}},e.toDisplayString(t.rowIndex+1),5)):e.createCommentVNode("",!0),t.TableData.config.treeView?(e.openBlock(),e.createBlock("td",{key:1,style:{width:"2ch","text-align":"center","background-color":"var(--brand-color)",color:"var(--header-text-color)","font-weight":"bold","border-color":"var(--header-border-color)","user-select":"none"},onClick:o[1]||(o[1]=e=>t.toggleRowExpand(e,t.rowIndex))},e.toDisplayString(t.getRowExpandSymbol()),5)):e.createCommentVNode("",!0),t.TableData.config.numberedRows||t.TableData.config.treeView?e.createCommentVNode("",!0):e.renderSlot(t.$slots,"indexCell",{key:2}),e.renderSlot(t.$slots,"default")],512)),[[e.vShow,!t.TableData.config.treeView||t.$parent.rowExpand(t.rowIndex)]])};const p=e.defineComponent({name:"ACell",props:{colIndex:{type:Number,required:!0,default:0},rowIndex:{type:Number,required:!0,default:0},tableid:{type:String,required:!0,default:()=>{}}},setup(t,o){const n=e.inject(t.tableid);let a=e.ref(!1);const r=e.computed((e=>void 0!==n.columns[t.colIndex].format?n.columns[t.colIndex].format(n.cellData(t.rowIndex,t.colIndex)):n.cellData(t.rowIndex,t.colIndex))),l=e.computed((()=>void 0!==n.columns[t.colIndex].align?n.columns[t.colIndex].align.toLowerCase():"center")),i=e.computed((()=>void 0!==n.columns[t.colIndex].width?n.columns[t.colIndex].width:"40ch"));let d="";return e.watch(a,(()=>{console.log(d)})),{TableData:n,updateData:function(e){e&&(void 0===n.columns[t.colIndex].component&&n.setCellData(t.rowIndex,t.colIndex,e.target.innerHTML),a=!0)},displayValue:r,handleInput:function(o){return void 0!==n.columns[t.colIndex].mask&&console.log("masking function"),n.columns[t.colIndex].hasOwnProperty("component")&&e.resolveDynamicComponent(n.columns[t.colIndex].component)&&(n.modal.component=this.$root.$.appContext.components[n.columns[t.colIndex].component],n.modal.visible=!0,n.modal.colIndex=t.colIndex,n.modal.rowIndex=t.rowIndex,n.modal.event=o,n.modal.parent=this),o},cellModified:a,textAlign:l,cellWidth:i,onFocus:function(e){d=e.target.innerText},onChange:function(e){e.target.innerHTML!==d&&(d=e.target.innerText,e.target.dispatchEvent(new Event("change")),a=!0)}}}});p.render=function(t,o,n,a,r,l){return e.openBlock(),e.createBlock("td",{ref:"colIndex + ':' + rowIndex",contenteditable:!0===t.TableData.columns[t.colIndex].edit,tabindex:0,spellcheck:!1,style:{"text-align":t.textAlign,width:t.cellWidth,"background-color":!1===t.cellModified?"inherit":"var(--cell-modified-color)","font-weight":!1===t.cellModified?"inherit":"bold"},onFocus:o[1]||(o[1]=e=>t.onFocus(e)),onPaste:o[2]||(o[2]=e=>t.onChange(e)),onBlur:o[3]||(o[3]=e=>t.onChange(e)),onInput:o[4]||(o[4]=e=>t.onChange(e)),onKeydown:[o[5]||(o[5]=e.withKeys(((...e)=>t.$parent.$parent.enterNav&&t.$parent.$parent.enterNav(...e)),["enter"])),o[6]||(o[6]=e.withKeys(((...e)=>t.$parent.$parent.tabNav&&t.$parent.$parent.tabNav(...e)),["tab"])),o[7]||(o[7]=e.withKeys(((...e)=>t.$parent.$parent.endNav&&t.$parent.$parent.endNav(...e)),["end"])),o[8]||(o[8]=e.withKeys(((...e)=>t.$parent.$parent.homeNav&&t.$parent.$parent.homeNav(...e)),["home"])),o[9]||(o[9]=e.withKeys(((...e)=>t.$parent.$parent.downArrowNav&&t.$parent.$parent.downArrowNav(...e)),["down"])),o[10]||(o[10]=e.withKeys(((...e)=>t.$parent.$parent.upArrowNav&&t.$parent.$parent.upArrowNav(...e)),["up"])),o[11]||(o[11]=e.withKeys(((...e)=>t.$parent.$parent.leftArrowNav&&t.$parent.$parent.leftArrowNav(...e)),["left"])),o[12]||(o[12]=e.withKeys(((...e)=>t.$parent.$parent.rightArrowNav&&t.$parent.$parent.rightArrowNav(...e)),["right"]))],onClick:o[13]||(o[13]=(...e)=>t.handleInput&&t.handleInput(...e)),innerHTML:t.displayValue},null,44,["contenteditable","innerHTML"])};const u=e.defineComponent({name:"ATableHeader",props:{columns:{type:Array,required:!0},config:{type:Object,default:()=>({})},tableid:{type:String,required:!0,default:()=>{}}},setup:(t,o)=>({TableData:e.inject(t.tableid)})}),f=e.withScopeId("data-v-16118e24");e.pushScopeId("data-v-16118e24");const m={key:0},h={tabindex:"-1"};e.popScopeId();const w=f(((t,o,n,a,r,l)=>t.columns.length?(e.openBlock(),e.createBlock("thead",m,[e.createVNode("tr",h,[t.TableData.zeroColumn?(e.openBlock(),e.createBlock("th",{key:0,style:{"min-width":t.TableData.numberedRowWidth}},null,4)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(t.columns,((o,n)=>(e.openBlock(),e.createBlock("th",{key:n,tabindex:"-1",style:{"text-align":void 0!==o.align?o.align.toLowerCase():"center","min-width":void 0!==o.width?o.width:"40ch"}},[e.renderSlot(t.$slots,"default",{},(()=>[e.createTextVNode(e.toDisplayString(void 0!==o.label?o.label:String.fromCharCode(n+97).toUpperCase()),1)]),{},!0)],4)))),128))])])):e.createCommentVNode("",!0)));u.render=w,u.__scopeId="data-v-16118e24";const g=e.defineComponent({name:"ATable",components:{ARow:s,ATableHeader:u,ACell:p},props:{columns:{type:Array,required:!0},rows:{type:Array,required:!1,default:()=>[]},config:{type:Object,default:()=>({})},tableid:{type:String,default:()=>{}}},setup(t,o){let n=e.ref([]),a=new c(t.id,t.columns,t.rows,t.config);!0===a.config.treeView&&a.rows.forEach(((e,t)=>{n.push({open:!1,isParent:!1,isRoot:null===e.parent||void 0===e.parent}),null!==e.parent&&void 0!==e.parent&&(n[e.parent].isParent=!0)})),e.provide(a.id,a);const r=function(e,t){a.config.treeView&&a.rows.forEach(((o,a)=>{o.parent===t&&(n[a].isParent&&r(e,a),n[a].open=!1)}))},l=function(e,t){a.rows.forEach(((e,o)=>{e.parent===t&&(n[o].open=!n[o].open)}))};function i(t){const o=t.target.cellIndex,r=t.target.parentElement.rowIndex,i=t.target.parentElement.parentElement;let d;i.rows.length!==r?(d=i.rows[r].cells[o],!0===a.config.treeView&&!1===n[r].open&&l(t,r-1)):d=t.target,e.nextTick((function(){d.focus()}))}function d(t){const o=t.target.cellIndex,r=t.target.parentElement.rowIndex,i=t.target.parentElement.parentElement;let d;1!==r?(d=i.rows[r-2].cells[o],!0===a.config.treeView&&!1===n[r-2].open&&l(t,a.rows[r-2].parent)):d=t.target,e.nextTick((function(){d.focus()}))}function s(t){let o;const r=t.target.cellIndex,i=t.target.parentElement.rowIndex,d=t.target.parentElement.parentElement;d.rows[i-1].cells.length-1===r?d.rows.length===i?o=d.rows[0].cells[!0===a.zeroColumn?1:0]:(o=d.rows[i].cells[!0===a.zeroColumn?1:0],!0===a.config.treeView&&!1===n[i].open&&l(t,i-1)):o=d.rows[i-1].cells[r+1],e.nextTick((function(){o.focus()}))}function p(e){let t;const o=e.target.cellIndex,n=e.target.parentElement.rowIndex,r=e.target.parentElement.parentElement;if(o===(!0===a.zeroColumn?1:0)){if(1===n)return;t=r.rows[n-2].cells[r.rows[n-2].cells.length-1],l(e,n-2)}else t=r.rows[n-1].cells[o-1];t.focus()}var u=e.ref({event:void 0,colIndex:void 0,rowIndex:void 0,component:"",tableid:a.id});return{TableData:a,displayRows:n,formatCell:function(e,t,o){let n;if(e?n=e.target.cellIndex+(!0===a.zeroColumn?-1:0):t&&o&&(n=a.columns.indexOf(t)),t||!("format"in a.columns[n]))return o&&"format"in t?t.format(o):(o&&t.type.toLowerCase(),o);e.target.innerHTML=a.columns[n].format(e.target.innerHTML)},getIndent:function(e,t){return t&&0===e&&t>0?1*t+"ch":null},rowExpand:function(e){return n[e].isRoot||n[e].open},toggleRowExpand:l,toggleRowExpandDeep:function(e,t){l(e,t)},toggleRowCollapseDeep:r,enterNav:function(e){e.preventDefault(),e.stopPropagation(),!0===e.shiftKey?d(e):i(e)},tabNav:function(e){e.preventDefault(),e.stopPropagation(),!0===e.shiftKey?p(e):s(e)},downArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),i(e))},upArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),d(e))},leftArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),p(e))},rightArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),s(e))},homeNav:function(e){let t;const o=e.target.cellIndex,n=e.target.parentElement.rowIndex,r=e.target.parentElement.parentElement;o!==(!0===a.config.numberedRows?1:0)&&(t=r.rows[n-1].cells[!0===a.zeroColumn?1:0],t.focus())},endNav:function(e){let t;const o=e.target.cellIndex,n=e.target.parentElement.rowIndex,r=e.target.parentElement.parentElement;r.rows[n-1].cells.length-1!==o&&(t=r.rows[n-1].cells[a.columns.length-(!0===a.zeroColumn?0:1)],t.focus())},prevCell:p,nextCell:s,upCell:d,downCell:i,moveCursorToEnd:function(e){e.focus(),document.execCommand("selectAll",!1,null),document.getSelection().collapseToEnd()},modal:u}}}),b=e.withScopeId("data-v-601dd5f4");e.pushScopeId("data-v-601dd5f4");const v={class:"atable"};e.popScopeId();const x=b(((t,o,n,a,r,l)=>{const i=e.resolveComponent("ATableHeader"),d=e.resolveComponent("ACell"),c=e.resolveComponent("ARow"),s=e.resolveComponent("ATableModal");return e.openBlock(),e.createBlock("table",v,[e.renderSlot(t.$slots,"tableheader",{},(()=>[e.createVNode(i,{columns:t.TableData.columns,config:t.TableData.config,tableid:t.TableData.id},null,8,["columns","config","tableid"])]),{},!0),e.createVNode("tbody",null,[(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(t.TableData.rows,((o,n)=>(e.openBlock(),e.createBlock(c,{key:o.id,row:o,"row-index":n,"is-parent":!0===t.TableData.config.treeView?t.displayRows[n].isParent:null,"is-open":!0===t.TableData.config.treeView?t.displayRows[n].open:null,tableid:t.TableData.id},{default:b((()=>[(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(t.TableData.columns,((o,a)=>(e.openBlock(),e.createBlock(d,{key:a,tableid:t.TableData.id,col:o,tabindex:"0",spellcheck:"false","row-index":n,"col-index":a+Number(!0===t.TableData.zeroColumn?0:-1),style:{"text-align":void 0!==o.align?o.align.toLowerCase():"center","min-width":void 0!==o.width?o.width:"40ch","padding-left":t.getIndent(a,t.TableData.rows[n].indent)}},null,8,["tableid","col","row-index","col-index","style"])))),128))])),_:2},1032,["row","row-index","is-parent","is-open","tableid"])))),128))]),e.renderSlot(t.$slots,"footer",{},void 0,!0),e.createVNode(s,{colIndex:t.TableData.modal.colIndex,rowIndex:t.TableData.modal.rowIndex,event:t.TableData.modal.event,tableid:t.TableData.id,style:{"{border":"1px solid var(--brand-color)"}},{default:b((()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.TableData.modal.component),{colIndex:t.TableData.modal.colIndex,rowIndex:t.TableData.modal.rowIndex,event:t.TableData.modal.event,tableid:t.TableData.id},null,8,["colIndex","rowIndex","event","tableid"]))])),_:1},8,["colIndex","rowIndex","event","tableid"])])}));g.render=x,g.__scopeId="data-v-601dd5f4";const y={name:"ATableModal",props:{event:{type:MouseEvent,required:!1},colIndex:{type:Number,required:!1,default:0},rowIndex:{type:Number,required:!1,default:0},tableid:{type:String,required:!1,default:()=>{}}},data:()=>({modal:{left:"",top:"",width:"",parent:""},isVisible:!1}),methods:{handleInput(e){e.stopPropagation()},clickOutside(e){console.log("click outside"),this.modal.parent.contains(e.target)?e.stopPropagation():(console.log("click outside"),this.isVisible=!1),e.target.blur()}},watch:{event(){if(console.log("event",this.$props.event),void 0!==this.$props.event){this.isVisible=!0;const e=this.$props.event.target.getBoundingClientRect();this.modal.left=e.left+"px",this.modal.top=e.top+e.height+"px",this.modal.width=e.width+"px",this.modal.parent=this.$props.event.target,window.addEventListener("click",this.clickOutside)}}}},I=e.withScopeId("data-v-8ff36780")(((t,o,n,a,r,l)=>e.withDirectives((e.openBlock(),e.createBlock("div",{ref:"amodal",class:"amodal",style:{left:r.modal.left,top:r.modal.top,width:r.modal.width},tabindex:"-1",onClick:o[1]||(o[1]=(...e)=>l.handleInput&&l.handleInput(...e)),onInput:o[2]||(o[2]=(...e)=>l.handleInput&&l.handleInput(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],36)),[[e.vShow,r.isVisible]])));return y.render=I,y.__scopeId="data-v-8ff36780",{install:function(e,t){e.component("ATable",g),e.component("ATableHeader",u),e.component("ATableModal",y)}}}));
