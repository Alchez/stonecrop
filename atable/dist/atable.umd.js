!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["@sedum/aform"]=t(e.Vue)}(this,(function(e){"use strict";var t,n=new Uint8Array(16);function o(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(n)}var r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function a(e){return"string"==typeof e&&r.test(e)}for(var l=[],i=0;i<256;++i)l.push((i+256).toString(16).substr(1));function d(e,t,n){var r=(e=e||{}).random||(e.rng||o)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n}(r)}class c{constructor(t,n=[],o=[],r={},a,l){this.id=void 0===t?d():t,this.rows=o,this.columns=e.reactive(n),this.config=e.reactive(r),this.table=void 0===a?e.reactive(this.createTableObject(o)):a,this.display=this.createDisplayObject(l)}createTableObject(e){let t={};return this.columns.forEach(((n,o)=>{e.forEach(((n,r)=>{t[o+":"+r]=e[r][this.columns[o].name]}))})),t}createDisplayObject(t){let n={};return n=!0===this.config.treeView?{modified:e.ref(!1),open:e.ref(!1),isParent:!1,isRoot:!1}:{modified:!1},void 0!==t&&t.hasOwnProperty("0:0")||(void 0!==t&&t.hasOwnProperty("default")&&(n=t.default),t={},Object.keys(this.table).forEach((e=>{t[e]=n}))),t}get zeroColumn(){return!(!this.config.numberedRows&&!this.config.treeView)}get numberedRowWidth(){e.computed((()=>String(Math.ceil(this.rows.length/100)+1)+"ch"))}cellData(e,t){return this.table[t+":"+e]}setCellData(e,t,n){return this.table[t+":"+e]!==n&&(this.display[t+":"+e].modified=!0),this.table[t+":"+e]=n,this.table[t+":"+e]}}const s=e.defineComponent({name:"ARow",props:{row:{type:Object,required:!0,default:()=>({})},rowIndex:{type:Number,required:!0,default:0},isParent:{type:Boolean,default:!1},tableid:{type:String,required:!0,default:()=>{}}},setup:(t,n)=>({open:e.ref(!1),TableData:e.inject(t.tableid),getRowExpandSymbol:function(){return this.isParent&&!this.open?"+":this.isParent&&this.open?"-":""},toggleRowExpand:function(e,t){this.open?this.$parent.toggleRowCollapseDeep(e,t):this.$parent.toggleRowExpand(e,t),this.open=!this.open}})});s.render=function(t,n,o,r,a,l){return e.withDirectives((e.openBlock(),e.createBlock("tr",null,[t.TableData.config.numberedRows?(e.openBlock(),e.createBlock("td",{key:0,style:{width:"TableData.numberedRowWidth","text-align":"center","background-color":"var(--brand-color)",color:"var(--header-text-color)","font-weight":"bold","border-color":"var(--header-border-color)","user-select":"none"}},e.toDisplayString(t.rowIndex+1),5)):e.createCommentVNode("",!0),t.TableData.config.treeView?(e.openBlock(),e.createBlock("td",{key:1,style:{width:"2ch","text-align":"center","background-color":"var(--brand-color)",color:"var(--header-text-color)","font-weight":"bold","border-color":"var(--header-border-color)","user-select":"none"},onClick:n[1]||(n[1]=e=>t.toggleRowExpand(e,t.rowIndex))},e.toDisplayString(t.getRowExpandSymbol()),5)):e.createCommentVNode("",!0),t.TableData.config.numberedRows||t.TableData.config.treeView?e.createCommentVNode("",!0):e.renderSlot(t.$slots,"indexCell",{key:2}),e.renderSlot(t.$slots,"default")],512)),[[e.vShow,!t.TableData.config.treeView||t.$parent.rowExpand(t.rowIndex)]])};const p=e.defineComponent({name:"ACell",props:{colIndex:{type:Number,required:!0,default:0},rowIndex:{type:Number,required:!0,default:0},tableid:{type:String,required:!0,default:()=>{}}},setup(t,n){const o=e.inject(t.tableid);let r=e.ref(!1);const a=e.computed((e=>void 0!==o.columns[t.colIndex].format?o.columns[t.colIndex].format(o.cellData(t.rowIndex,t.colIndex)):o.cellData(t.rowIndex,t.colIndex))),l=e.computed((()=>void 0!==o.columns[t.colIndex].align?o.columns[t.colIndex].align.toLowerCase():"center")),i=e.computed((()=>void 0!==o.columns[t.colIndex].width?o.columns[t.colIndex].width:"40ch"));let d="";return e.watch(r,(()=>{console.log(d)})),{TableData:o,updateData:function(e){e&&(void 0===o.columns[t.colIndex].component&&o.setCellData(t.rowIndex,t.colIndex,e.target.innerHTML),r=!0,console.log("cellmodified",r))},displayValue:a,handleInput:function(e){return void 0!==o.columns[t.colIndex].mask&&console.log("masking function"),o.columns[t.colIndex].hasOwnProperty("component")&&o.columns[t.colIndex].component(e,t.rowIndex,t.colIndex,this,o.id),e},cellModified:r,textAlign:l,cellWidth:i,onFocus:function(e){d=e.target.innerText},onChange:function(e){e.target.innerHTML!==d&&(d=e.target.innerText,e.target.dispatchEvent(new Event("change")),r=!0)}}}}),u=e.withScopeId("data-v-9019e270")(((t,n,o,r,a,l)=>(e.openBlock(),e.createBlock("td",{ref:"colIndex + ':' + rowIndex",contenteditable:!0===t.TableData.columns[t.colIndex].edit,tabindex:0,spellcheck:!1,style:{"text-align":t.textAlign,width:t.cellWidth,"background-color":!1===t.cellModified?"inherit":"var(--cell-modified-color)","font-weight":!1===t.cellModified?"inherit":"bold"},onFocus:n[1]||(n[1]=e=>t.onFocus(e)),onPaste:n[2]||(n[2]=e=>t.onChange(e)),onBlur:n[3]||(n[3]=e=>t.onChange(e)),onInput:n[4]||(n[4]=e=>t.onChange(e)),onKeydown:[n[5]||(n[5]=e.withKeys(((...e)=>t.$parent.$parent.enterNav&&t.$parent.$parent.enterNav(...e)),["enter"])),n[6]||(n[6]=e.withKeys(((...e)=>t.$parent.$parent.tabNav&&t.$parent.$parent.tabNav(...e)),["tab"])),n[7]||(n[7]=e.withKeys(((...e)=>t.$parent.$parent.endNav&&t.$parent.$parent.endNav(...e)),["end"])),n[8]||(n[8]=e.withKeys(((...e)=>t.$parent.$parent.homeNav&&t.$parent.$parent.homeNav(...e)),["home"])),n[9]||(n[9]=e.withKeys(((...e)=>t.$parent.$parent.downArrowNav&&t.$parent.$parent.downArrowNav(...e)),["down"])),n[10]||(n[10]=e.withKeys(((...e)=>t.$parent.$parent.upArrowNav&&t.$parent.$parent.upArrowNav(...e)),["up"])),n[11]||(n[11]=e.withKeys(((...e)=>t.$parent.$parent.leftArrowNav&&t.$parent.$parent.leftArrowNav(...e)),["left"])),n[12]||(n[12]=e.withKeys(((...e)=>t.$parent.$parent.rightArrowNav&&t.$parent.$parent.rightArrowNav(...e)),["right"]))],onClick:n[13]||(n[13]=(...e)=>t.handleInput&&t.handleInput(...e)),innerHTML:t.displayValue},null,44,["contenteditable","innerHTML"]))));p.render=u,p.__scopeId="data-v-9019e270";const f=e.defineComponent({name:"ATableHeader",props:{columns:{type:Array,required:!0},config:{type:Object,default:()=>({})},tableid:{type:String,required:!0,default:()=>{}}},setup:(t,n)=>({TableData:e.inject(t.tableid)})}),h=e.withScopeId("data-v-16118e24");e.pushScopeId("data-v-16118e24");const m={key:0},g={tabindex:"-1"};e.popScopeId();const w=h(((t,n,o,r,a,l)=>t.columns.length?(e.openBlock(),e.createBlock("thead",m,[e.createVNode("tr",g,[t.TableData.zeroColumn?(e.openBlock(),e.createBlock("th",{key:0,style:{"min-width":t.TableData.numberedRowWidth}},null,4)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(t.columns,((n,o)=>(e.openBlock(),e.createBlock("th",{key:o,tabindex:"-1",style:{"text-align":void 0!==n.align?n.align.toLowerCase():"center","min-width":void 0!==n.width?n.width:"40ch"}},[e.renderSlot(t.$slots,"default",{},(()=>[e.createTextVNode(e.toDisplayString(void 0!==n.label?n.label:String.fromCharCode(o+97).toUpperCase()),1)]),{},!0)],4)))),128))])])):e.createCommentVNode("",!0)));f.render=w,f.__scopeId="data-v-16118e24";const b=e.defineComponent({name:"ATable",components:{ARow:s,ATableHeader:f,ACell:p},props:{columns:{type:Array,required:!0},rows:{type:Array,required:!1,default:()=>[]},config:{type:Object,default:()=>({})},tableid:{type:String,default:()=>{}}},setup(t,n){let o=e.reactive([]),r=new c(t.id,t.columns,t.rows,t.config);!0===r.config.treeView&&r.rows.forEach(((e,t)=>{o.push({open:!1,isParent:!1,isRoot:null===e.parent||void 0===e.parent}),null!==e.parent&&void 0!==e.parent&&(o[e.parent].isParent=!0)})),e.provide(r.id,r);const a=function(e,t){r.config.treeView&&r.rows.forEach(((n,r)=>{n.parent===t&&(o[r].isParent&&a(e,r),o[r].open=!1)}))},l=function(e,t){r.rows.forEach(((e,n)=>{e.parent===t&&(o[n].open=!o[n].open)}))};function i(t){const n=t.target.cellIndex,a=t.target.parentElement.rowIndex,i=t.target.parentElement.parentElement;let d;i.rows.length!==a?(d=i.rows[a].cells[n],!0===r.config.treeView&&!1===o[a].open&&l(t,a-1)):d=t.target,e.nextTick((function(){d.focus()}))}function d(t){const n=t.target.cellIndex,a=t.target.parentElement.rowIndex,i=t.target.parentElement.parentElement;let d;1!==a?(d=i.rows[a-2].cells[n],!0===r.config.treeView&&!1===o[a-2].open&&l(t,r.rows[a-2].parent)):d=t.target,e.nextTick((function(){d.focus()}))}function s(t){let n;const a=t.target.cellIndex,i=t.target.parentElement.rowIndex,d=t.target.parentElement.parentElement;d.rows[i-1].cells.length-1===a?d.rows.length===i?n=d.rows[0].cells[!0===r.zeroColumn?1:0]:(n=d.rows[i].cells[!0===r.zeroColumn?1:0],!0===r.config.treeView&&!1===o[i].open&&l(t,i-1)):n=d.rows[i-1].cells[a+1],e.nextTick((function(){n.focus()}))}function p(e){let t;const n=e.target.cellIndex,o=e.target.parentElement.rowIndex,a=e.target.parentElement.parentElement;if(n===(!0===r.zeroColumn?1:0)){if(1===o)return;t=a.rows[o-2].cells[a.rows[o-2].cells.length-1],l(e,o-2)}else t=a.rows[o-1].cells[n-1];t.focus()}return{TableData:r,displayRows:o,formatCell:function(e,t,n){let o;if(e?o=e.target.cellIndex+(!0===r.zeroColumn?-1:0):t&&n&&(o=r.columns.indexOf(t)),t||!("format"in r.columns[o]))return n&&"format"in t?t.format(n):(n&&t.type.toLowerCase(),n);e.target.innerHTML=r.columns[o].format(e.target.innerHTML)},getIndent:function(e,t){return t&&0===e&&t>0?1*t+"ch":"inherit"},rowExpand:function(e){return o[e].isRoot||o[e].open},toggleRowExpand:l,toggleRowExpandDeep:function(e,t){l(e,t)},toggleRowCollapseDeep:a,enterNav:function(e){e.preventDefault(),e.stopPropagation(),!0===e.shiftKey?d(e):i(e)},tabNav:function(e){e.preventDefault(),e.stopPropagation(),!0===e.shiftKey?p(e):s(e)},downArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),i(e))},upArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),d(e))},leftArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),p(e))},rightArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),s(e))},homeNav:function(e){let t;const n=e.target.cellIndex,o=e.target.parentElement.rowIndex,a=e.target.parentElement.parentElement;n!==(!0===r.config.numberedRows?1:0)&&(t=a.rows[o-1].cells[!0===r.zeroColumn?1:0],t.focus())},endNav:function(e){let t;const n=e.target.cellIndex,o=e.target.parentElement.rowIndex,a=e.target.parentElement.parentElement;a.rows[o-1].cells.length-1!==n&&(t=a.rows[o-1].cells[r.columns.length-(!0===r.zeroColumn?0:1)],t.focus())},prevCell:p,nextCell:s,upCell:d,downCell:i,moveCursorToEnd:function(e){e.focus(),document.execCommand("selectAll",!1,null),document.getSelection().collapseToEnd()}}}}),v=e.withScopeId("data-v-4cf03916");e.pushScopeId("data-v-4cf03916");const y={class:"atable"};e.popScopeId();const x=v(((t,n,o,r,a,l)=>{const i=e.resolveComponent("ATableHeader"),d=e.resolveComponent("ACell"),c=e.resolveComponent("ARow");return e.openBlock(),e.createBlock("table",y,[e.renderSlot(t.$slots,"tableheader",{},(()=>[e.createVNode(i,{columns:t.TableData.columns,config:t.TableData.config,tableid:t.TableData.id},null,8,["columns","config","tableid"])]),{},!0),e.createVNode("tbody",null,[(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(t.TableData.rows,((n,o)=>(e.openBlock(),e.createBlock(c,{key:n.id,row:n,"row-index":o,"is-parent":!0===t.TableData.config.treeView?t.displayRows[o].isParent:null,"is-open":!0===t.TableData.config.treeView?t.displayRows[o].open:null,tableid:t.TableData.id},{default:v((()=>[(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(t.TableData.columns,((n,r)=>(e.openBlock(),e.createBlock(d,{key:r,tableid:t.TableData.id,col:n,tabindex:"0",spellcheck:"false","row-index":o,"col-index":r+Number(!0===t.TableData.zeroColumn?0:-1),style:{"text-align":void 0!==n.align?n.align.toLowerCase():"center","min-width":void 0!==n.width?n.width:"40ch","padding-left":t.getIndent(r,t.TableData.rows[o].indent)}},null,8,["tableid","col","row-index","col-index","style"])))),128))])),_:2},1032,["row","row-index","is-parent","is-open","tableid"])))),128))]),e.renderSlot(t.$slots,"footer",{},void 0,!0)])}));b.render=x,b.__scopeId="data-v-4cf03916";const I={name:"ATableModal",props:{event:{type:MouseEvent,required:!0},colIndex:{type:Number,required:!0,default:0},rowIndex:{type:Number,required:!0,default:0},tableid:{type:String,required:!0,default:()=>{}}},data:()=>({modal:{left:"",top:"",width:""}}),created(){const e=this.$props.event.target.getBoundingClientRect();this.modal.left=e.left-2+"px",this.modal.top=e.top+e.height-2+"px",this.modal.width=e.width-4+"px",window.addEventListener("click",this.clickOutside)},methods:{handleInput(e){e.stopPropagation()},clickOutside(e){this.$el.parentElement.contains(e.target)?e.stopPropagation():this.destroy(),e.target.blur()},destroy(){window.removeEventListener("click",this.clickOutside,!1),this.$emit("change",this.cellData),this.$el.parentElement.removeChild(this.$el)}}},C=e.withScopeId("data-v-42872482")(((t,n,o,r,a,l)=>(e.openBlock(),e.createBlock("div",{ref:"amodal",class:"amodal",style:{left:a.modal.left,top:a.modal.top,width:a.modal.width},tabindex:"-1",onClick:n[1]||(n[1]=(...e)=>l.handleInput&&l.handleInput(...e)),onInput:n[2]||(n[2]=(...e)=>l.handleInput&&l.handleInput(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],36))));return I.render=C,I.__scopeId="data-v-42872482",{install:function(e,t){e.component("ATable",b),e.component("ATableHeader",f),e.component("ATableModal",I)}}}));
