!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["@sedum/aform"]=t(e.Vue)}(this,(function(e){"use strict";var t,n=new Uint8Array(16);function o(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(n)}var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function l(e){return"string"==typeof e&&a.test(e)}for(var r=[],d=0;d<256;++d)r.push((d+256).toString(16).substr(1));function i(e,t,n){var a=(e=e||{}).random||(e.rng||o)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){n=n||0;for(var d=0;d<16;++d)t[n+d]=a[d];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase();if(!l(n))throw TypeError("Stringified UUID is invalid");return n}(a)}class c{constructor(t,n=[],o=[],a={},l,r){this.id=void 0===t?i():t,this.rows=o,this.columns=e.reactive(n),this.config=e.reactive(a),this.table=void 0===l?e.reactive(this.createTableObject()):l,this.display=this.createDisplayObject(r),this.modal=e.reactive({visible:!1,rowIndex:void 0,colIndex:void 0,event:void 0,top:void 0,left:void 0,width:void 0})}createTableObject(){let e={};for(const[t,n]of this.columns.entries())for(const[o,a]of this.rows.entries())e[`${t}:${o}`]=a[n.name];return e}createDisplayObject(t){let n={modified:!1};if(void 0!==t&&t.hasOwnProperty("0:0"))return t;void 0!==t&&t.hasOwnProperty("default")&&(n=t.default);let o=new Set;for(let e=this.rows.length-1;e>=0;e--){let t=this.rows[e];t.parent&&o.add(t.parent),n[e]={modified:!1,open:null===t.parent||void 0===t.parent,isParent:!!o.has(e),parent:t.parent,isRoot:null===t.parent||void 0===t.parent,indent:t.indent||null,childrenOpen:!1}}return e.reactive(n)}get zeroColumn(){return!(!this.config.numberedRows&&!this.config.treeView)}get numberedRowWidth(){e.computed((()=>String(Math.ceil(this.rows.length/100)+1)+"ch"))}cellData(e,t){return this.table[`${e}:${t}`]}setCellData(e,t,n){return this.table[`${t}:${e}`]!==n&&(this.display[`${t}:${e}`].modified=!0),this.table[`${t}:${e}`]=n,this.table[`${t}:${e}`]}toggleRowExpand(e){if(this.config.treeView){this.display[e].childrenOpen=!this.display[e].childrenOpen;for(let t=this.rows.length-1;t>=0;t--)this.display[t].parent===e&&(this.display[t].open=!this.display[t].open,this.display[t].childrenOpen&&this.toggleRowExpand(t))}}}const s=e.defineComponent({name:"ARow",props:{row:{type:Object,required:!0,default:()=>({})},rowIndex:{type:Number,required:!0,default:0},tableid:{type:String,required:!0,default:()=>{}}},setup(t){const n=e.inject(t.tableid);return{TableData:n,getRowExpandSymbol:function(){return n.config.treeView?n.display[t.rowIndex].isRoot&&!n.display[t.rowIndex].childrenOpen?"+":n.display[t.rowIndex].isRoot&&n.display[t.rowIndex].childrenOpen?"-":n.display[t.rowIndex].isParent&&!n.display[t.rowIndex].childrenOpen?"+":n.display[t.rowIndex].isParent&&n.display[t.rowIndex].childrenOpen?"-":"":""},toggleRowExpand:function(e){n.toggleRowExpand(e)},rowVisible:function(){return!n.config.treeView||(!!n.display[t.rowIndex].isRoot||n.display[t.rowIndex].open)}}}});s.render=function(t,n,o,a,l,r){return e.withDirectives((e.openBlock(),e.createBlock("tr",null,[t.TableData.config.numberedRows?(e.openBlock(),e.createBlock("td",{key:0,style:{width:"TableData.numberedRowWidth","text-align":"center","background-color":"var(--brand-color)",color:"var(--header-text-color)","font-weight":"bold","border-color":"var(--header-border-color)","user-select":"none"}},e.toDisplayString(t.rowIndex+1),5)):e.createCommentVNode("",!0),t.TableData.config.treeView?(e.openBlock(),e.createBlock("td",{key:1,style:{width:"2ch","text-align":"center","background-color":"var(--brand-color)",color:"var(--header-text-color)","font-weight":"bold","border-color":"var(--header-border-color)","user-select":"none"},onClick:n[1]||(n[1]=e=>t.toggleRowExpand(t.rowIndex))},e.toDisplayString(t.getRowExpandSymbol()),5)):e.createCommentVNode("",!0),t.TableData.config.numberedRows||t.TableData.config.treeView?e.createCommentVNode("",!0):e.renderSlot(t.$slots,"indexCell",{key:2}),e.renderSlot(t.$slots,"default")],512)),[[e.vShow,t.rowVisible()]])};const p=e.defineComponent({name:"ACell",props:{colIndex:{type:Number,required:!0,default:0},rowIndex:{type:Number,required:!0,default:0},tableid:{type:String,required:!0,default:()=>{}}},setup(t){const n=e.inject(t.tableid);let o=e.ref(!1);const a=e.computed((()=>void 0!==n.columns[t.colIndex].format?n.columns[t.colIndex].format(n.cellData(t.colIndex,t.rowIndex)):n.cellData(t.colIndex,t.rowIndex))),l=e.computed((()=>void 0!==n.columns[t.colIndex].align?n.columns[t.colIndex].align.toLowerCase():"center")),r=e.computed((()=>void 0!==n.columns[t.colIndex].width?n.columns[t.colIndex].width:"40ch"));let d="";return e.watch(o,(()=>{console.log(d)})),{TableData:n,updateData:function(e){e&&(void 0===n.columns[t.colIndex].component&&n.setCellData(t.rowIndex,t.colIndex,e.target.innerHTML),o=!0)},displayValue:a,handleInput:function(o){if(void 0!==n.columns[t.colIndex].mask&&console.log("masking function"),n.columns[t.colIndex].hasOwnProperty("component")){if(e.resolveDynamicComponent(n.columns[t.colIndex].component)){const e=o.target.getBoundingClientRect();n.modal.visible=!0,n.modal.colIndex=t.colIndex,n.modal.rowIndex=t.rowIndex,n.modal.parent=o.target,n.modal.top=e.top+e.height,n.modal.left=e.left,n.modal.width=r,n.modal.component=n.columns[t.colIndex].component}console.log(o.target)}return o},cellModified:o,textAlign:l,cellWidth:r,onFocus:function(e){d=e.target.innerText},onChange:function(e){e.target.innerHTML!==d&&(d=e.target.innerText,e.target.dispatchEvent(new Event("change")),o=!0),console.log("cellModified",o)},getIndent:function(e,t){return t&&0===e&&t>0?1*t+"ch":"inherit"}}}}),u=e.withScopeId("data-v-f81c70ec")(((t,n,o,a,l,r)=>{var d;return e.openBlock(),e.createBlock("td",{ref:"colIndex + ':' + rowIndex",contenteditable:!0===t.TableData.columns[t.colIndex].edit,tabindex:0,spellcheck:!1,style:{"text-align":t.textAlign,width:t.cellWidth,"background-color":!1===t.cellModified?"inherit":"var(--cell-modified-color)","font-weight":!1===t.cellModified?"inherit":"bold","padding-left":t.getIndent(t.colIndex,null==(d=t.TableData.display[t.rowIndex])?void 0:d.indent)},onFocus:n[1]||(n[1]=e=>t.onFocus(e)),onPaste:n[2]||(n[2]=e=>t.onChange(e)),onBlur:n[3]||(n[3]=e=>t.onChange(e)),onInput:n[4]||(n[4]=e=>t.onChange(e)),onKeydown:[n[5]||(n[5]=e.withKeys(((...e)=>t.$parent.$parent.enterNav&&t.$parent.$parent.enterNav(...e)),["enter"])),n[6]||(n[6]=e.withKeys(((...e)=>t.$parent.$parent.tabNav&&t.$parent.$parent.tabNav(...e)),["tab"])),n[7]||(n[7]=e.withKeys(((...e)=>t.$parent.$parent.endNav&&t.$parent.$parent.endNav(...e)),["end"])),n[8]||(n[8]=e.withKeys(((...e)=>t.$parent.$parent.homeNav&&t.$parent.$parent.homeNav(...e)),["home"])),n[9]||(n[9]=e.withKeys(((...e)=>t.$parent.$parent.downArrowNav&&t.$parent.$parent.downArrowNav(...e)),["down"])),n[10]||(n[10]=e.withKeys(((...e)=>t.$parent.$parent.upArrowNav&&t.$parent.$parent.upArrowNav(...e)),["up"])),n[11]||(n[11]=e.withKeys(((...e)=>t.$parent.$parent.leftArrowNav&&t.$parent.$parent.leftArrowNav(...e)),["left"])),n[12]||(n[12]=e.withKeys(((...e)=>t.$parent.$parent.rightArrowNav&&t.$parent.$parent.rightArrowNav(...e)),["right"]))],onClick:n[13]||(n[13]=(...e)=>t.handleInput&&t.handleInput(...e)),innerHTML:t.displayValue},null,44,["contenteditable","innerHTML"])}));p.render=u,p.__scopeId="data-v-f81c70ec";const f=e.defineComponent({name:"ATableHeader",props:{columns:{type:Array,required:!0},config:{type:Object,default:()=>({})},tableid:{type:String,required:!0,default:()=>{}}},setup:t=>({TableData:e.inject(t.tableid)})}),m=e.withScopeId("data-v-bf1b4a04");e.pushScopeId("data-v-bf1b4a04");const w={key:0},g={tabindex:"-1"};e.popScopeId();const h=m(((t,n,o,a,l,r)=>t.columns.length?(e.openBlock(),e.createBlock("thead",w,[e.createVNode("tr",g,[t.TableData.zeroColumn?(e.openBlock(),e.createBlock("th",{key:0,style:{"min-width":t.TableData.numberedRowWidth}},null,4)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(t.columns,((n,o)=>(e.openBlock(),e.createBlock("th",{key:o,tabindex:"-1",style:{"text-align":void 0!==n.align?n.align.toLowerCase():"center","min-width":void 0!==n.width?n.width:"40ch"}},[e.renderSlot(t.$slots,"default",{},(()=>[e.createTextVNode(e.toDisplayString(void 0!==n.label?n.label:String.fromCharCode(o+97).toUpperCase()),1)]),{},!0)],4)))),128))])])):e.createCommentVNode("",!0)));f.render=h,f.__scopeId="data-v-bf1b4a04";const b=e.defineComponent({name:"ATableModal",props:{colIndex:{type:Number,required:!1,default:0},rowIndex:{type:Number,required:!1,default:0},tableid:{type:String,required:!1}},setup:t=>({TableData:e.inject(t.tableid),handleInput:function(e){e.stopPropagation()}})}),x=e.withScopeId("data-v-5e464449")(((t,n,o,a,l,r)=>(e.openBlock(),e.createBlock("div",{ref:"amodal",class:"amodal",tabindex:"-1",onClick:n[1]||(n[1]=(...e)=>t.handleInput&&t.handleInput(...e)),onInput:n[2]||(n[2]=(...e)=>t.handleInput&&t.handleInput(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],544))));b.render=x,b.__scopeId="data-v-5e464449";const v=e.defineComponent({name:"ATable",components:{ATableModal:b,ARow:s,ATableHeader:f,ACell:p},props:{columns:{type:Array,required:!0},rows:{type:Array,required:!1,default:()=>[]},config:{type:Object,default:()=>({})},tableid:{type:String,default:()=>{}}},setup(t){let n=new c(t.id,t.columns,t.rows,t.config);e.provide(n.id,n);function o(t){const o=t.target.cellIndex,a=t.target.parentElement.rowIndex,l=t.target.parentElement.parentElement;let r;l.rows.length!==a?(r=l.rows[a].cells[o],!0===n.config.treeView&&!1===n.display[a].open&&n.toggleRowExpand(a-1)):r=t.target,e.nextTick((function(){r.focus()}))}function a(t){const o=t.target.cellIndex,a=t.target.parentElement.rowIndex,l=t.target.parentElement.parentElement;let r;1!==a?(r=l.rows[a-2].cells[o],!0===n.config.treeView&&!1===n.display[a-2].open&&n.toggleRowExpand(n.display[a-2].parent)):r=t.target,e.nextTick((function(){r.focus()}))}function l(t){let o;const a=t.target.cellIndex,l=t.target.parentElement.rowIndex,r=t.target.parentElement.parentElement;r.rows[l-1].cells.length-1===a?r.rows.length===l?o=r.rows[0].cells[!0===n.zeroColumn?1:0]:(o=r.rows[l].cells[!0===n.zeroColumn?1:0],!0===n.config.treeView&&!1===n.display[l].open&&n.toggleRowExpand(l-1)):o=r.rows[l-1].cells[a+1],e.nextTick((function(){o.focus()}))}function r(e){let t;const o=e.target.cellIndex,a=e.target.parentElement.rowIndex,l=e.target.parentElement.parentElement;if(o===(!0===n.zeroColumn?1:0)){if(1===a)return;t=l.rows[a-2].cells[l.rows[a-2].cells.length-1],n.toggleRowExpand(a-2)}else t=l.rows[a-1].cells[o-1];t.focus()}return window.addEventListener("click",(function(e){if(n.modal.parent)if(n.modal.parent.contains(e.target));else{if(!n.modal.visible)return;n.modal.visible=!1}})),{TableData:n,v4:i,formatCell:function(e,t,o){let a;if(e?a=e.target.cellIndex+(!0===n.zeroColumn?-1:0):t&&o&&(a=n.columns.indexOf(t)),t||!("format"in n.columns[a]))return o&&"format"in t?t.format(o):(o&&t.type.toLowerCase(),o);e.target.innerHTML=n.columns[a].format(e.target.innerHTML)},enterNav:function(e){e.preventDefault(),e.stopPropagation(),!0===e.shiftKey?a(e):o(e)},tabNav:function(e){e.preventDefault(),e.stopPropagation(),!0===e.shiftKey?r(e):l(e)},downArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),o(e))},upArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),a(e))},leftArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),r(e))},rightArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),l(e))},homeNav:function(e){let t;const o=e.target.cellIndex,a=e.target.parentElement.rowIndex,l=e.target.parentElement.parentElement;o!==(!0===n.config.numberedRows?1:0)&&(t=l.rows[a-1].cells[!0===n.zeroColumn?1:0],t.focus())},endNav:function(e){let t;const o=e.target.cellIndex,a=e.target.parentElement.rowIndex,l=e.target.parentElement.parentElement;l.rows[a-1].cells.length-1!==o&&(t=l.rows[a-1].cells[n.columns.length-(!0===n.zeroColumn?0:1)],t.focus())},prevCell:r,nextCell:l,upCell:a,downCell:o,moveCursorToEnd:function(e){e.focus(),document.execCommand("selectAll",!1,null),document.getSelection().collapseToEnd()}}}}),y=e.withScopeId("data-v-455a3966");e.pushScopeId("data-v-455a3966");const I={class:"atable"};e.popScopeId();const T=y(((t,n,o,a,l,r)=>{const d=e.resolveComponent("ATableHeader"),i=e.resolveComponent("ACell"),c=e.resolveComponent("ARow"),s=e.resolveComponent("ATableModal");return e.openBlock(),e.createBlock("table",I,[e.renderSlot(t.$slots,"tableheader",{},(()=>[e.createVNode(d,{columns:t.TableData.columns,config:t.TableData.config,tableid:t.TableData.id},null,8,["columns","config","tableid"])]),{},!0),e.createVNode("tbody",null,[(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(t.TableData.rows,((n,o)=>(e.openBlock(),e.createBlock(c,{key:n.id||t.v4(),row:n,rowIndex:o,tableid:t.TableData.id},{default:y((()=>[(e.openBlock(!0),e.createBlock(e.Fragment,null,e.renderList(t.TableData.columns,((n,a)=>(e.openBlock(),e.createBlock(i,{key:a,tableid:t.TableData.id,col:n,tabindex:"0",spellcheck:"false",rowIndex:o,colIndex:a+Number(!0===t.TableData.zeroColumn?0:-1),style:{"text-align":void 0!==n.align?n.align.toLowerCase():"center","min-width":void 0!==n.width?n.width:"40ch"}},null,8,["tableid","col","rowIndex","colIndex","style"])))),128))])),_:2},1032,["row","rowIndex","tableid"])))),128))]),e.renderSlot(t.$slots,"footer",{},void 0,!0),e.withDirectives(e.createVNode(s,{colIndex:t.TableData.modal.colIndex,rowIndex:t.TableData.modal.rowIndex,tableid:t.TableData.id,style:{left:t.TableData.modal.left+"px",top:t.TableData.modal.top+"px","max-width":t.TableData.modal.width+"px"}},{default:y((()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.TableData.modal.component),{colIndex:t.TableData.modal.colIndex,rowIndex:t.TableData.modal.rowIndex,tableid:t.TableData.id},null,8,["colIndex","rowIndex","tableid"]))])),_:1},8,["colIndex","rowIndex","tableid","style"]),[[e.vShow,t.TableData.modal.visible]])])}));return v.render=T,v.__scopeId="data-v-455a3966",{install:function(e,t){e.component("ATable",v),e.component("ATableHeader",f),e.component("ATableModal",b)}}}));
