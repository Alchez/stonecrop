!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["@sedum/aform"]=t(e.Vue)}(this,(function(e){"use strict";var t,n=new Uint8Array(16);function o(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(n)}var l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function a(e){return"string"==typeof e&&l.test(e)}for(var r=[],i=0;i<256;++i)r.push((i+256).toString(16).substr(1));function d(e,t,n){var l=(e=e||{}).random||(e.rng||o)();if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=l[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n}(l)}class c{constructor(t,n=[],o=[],l={},a,r){this.id=void 0===t?d():t,this.rows=o,this.columns=e.reactive(n),this.config=e.reactive(l),this.table=void 0===a?e.reactive(this.createTableObject()):a,this.display=this.createDisplayObject(r),this.modal=e.reactive({visible:!1,rowIndex:void 0,colIndex:void 0,event:void 0,top:void 0,left:void 0,width:void 0})}createTableObject(){let e={};for(const[t,n]of this.columns.entries())for(const[o,l]of this.rows.entries())e[`${t}:${o}`]=l[n.name];return e}createDisplayObject(t){let n=Object.assign({},{modified:!1});if(void 0!==t&&t.hasOwnProperty("0:0"))return t;void 0!==t&&t.hasOwnProperty("default")&&(n=t.default);let o=new Set;for(let e=this.rows.length-1;e>=0;e--){let t=this.rows[e];t.parent&&o.add(t.parent),n[e]={modified:!1,open:null===t.parent||void 0===t.parent,isParent:!!o.has(e),parent:t.parent,isRoot:null===t.parent||void 0===t.parent,indent:t.indent||null,childrenOpen:!1}}return e.reactive(n)}get zeroColumn(){return!(!this.config.numberedRows&&!this.config.treeView)}get numberedRowWidth(){e.computed((()=>String(Math.ceil(this.rows.length/100)+1)+"ch"))}cellData(e,t){return this.table[`${e}:${t}`]}setCellData(e,t,n){return this.table[`${t}:${e}`]!==n&&(this.display[`${t}:${e}`].modified=!0),this.table[`${t}:${e}`]=n,this.table[`${t}:${e}`]}toggleRowExpand(e){if(this.config.treeView){this.display[e].childrenOpen=!this.display[e].childrenOpen;for(let t=this.rows.length-1;t>=0;t--)this.display[t].parent===e&&(this.display[t].open=!this.display[t].open,this.display[t].childrenOpen&&this.toggleRowExpand(t))}}}const s=e.defineComponent({name:"ARow",props:{row:{type:Object,required:!0,default:()=>({})},rowIndex:{type:Number,required:!0,default:0},tableid:{type:String,required:!0,default:()=>{}}},setup(t){const n=e.inject(t.tableid);return{TableData:n,getRowExpandSymbol:function(){return n.config.treeView?n.display[t.rowIndex].isRoot&&!n.display[t.rowIndex].childrenOpen?"+":n.display[t.rowIndex].isRoot&&n.display[t.rowIndex].childrenOpen?"-":n.display[t.rowIndex].isParent&&!n.display[t.rowIndex].childrenOpen?"+":n.display[t.rowIndex].isParent&&n.display[t.rowIndex].childrenOpen?"-":"":""},toggleRowExpand:function(e){n.toggleRowExpand(e)},rowVisible:function(){return!n.config.treeView||(!!n.display[t.rowIndex].isRoot||n.display[t.rowIndex].open)}}}});s.render=function(t,n,o,l,a,r){return e.withDirectives((e.openBlock(),e.createElementBlock("tr",null,[t.TableData.config.numberedRows?(e.openBlock(),e.createElementBlock("td",{key:0,style:e.normalizeStyle({width:"TableData.numberedRowWidth","text-align":"center","background-color":"var(--brand-color)",color:"var(--header-text-color)","font-weight":"bold","border-color":"var(--header-border-color)","user-select":"none"})},e.toDisplayString(t.rowIndex+1),5)):e.createCommentVNode("",!0),t.TableData.config.treeView?(e.openBlock(),e.createElementBlock("td",{key:1,style:e.normalizeStyle({width:"2ch","text-align":"center","background-color":"var(--brand-color)",color:"var(--header-text-color)","font-weight":"bold","border-color":"var(--header-border-color)","user-select":"none"}),onClick:n[0]||(n[0]=e=>t.toggleRowExpand(t.rowIndex))},e.toDisplayString(t.getRowExpandSymbol()),5)):e.createCommentVNode("",!0),t.TableData.config.numberedRows||t.TableData.config.treeView?e.createCommentVNode("",!0):e.renderSlot(t.$slots,"indexCell",{key:2}),e.renderSlot(t.$slots,"default")],512)),[[e.vShow,t.rowVisible()]])};const p=e.defineComponent({name:"ACell",props:{colIndex:{type:Number,required:!0,default:0},rowIndex:{type:Number,required:!0,default:0},tableid:{type:String,required:!0,default:()=>{}}},setup(t){const n=e.inject(t.tableid);let o=e.ref(!1);const l=e.computed((()=>void 0!==n.columns[t.colIndex].format?n.columns[t.colIndex].format(n.cellData(t.colIndex,t.rowIndex)):n.cellData(t.colIndex,t.rowIndex))),a=e.computed((()=>void 0!==n.columns[t.colIndex].align?n.columns[t.colIndex].align.toLowerCase():"center")),r=e.computed((()=>void 0!==n.columns[t.colIndex].width?n.columns[t.colIndex].width:"40ch"));let i="";return e.watch(o,(()=>{console.log(i)})),{TableData:n,updateData:function(e){e&&(void 0===n.columns[t.colIndex].component&&n.setCellData(t.rowIndex,t.colIndex,e.target.innerHTML),o=!0)},displayValue:l,handleInput:function(o){if(void 0!==n.columns[t.colIndex].mask&&console.log("masking function"),n.columns[t.colIndex].hasOwnProperty("component")){if(e.resolveDynamicComponent(n.columns[t.colIndex].component)){const e=o.target.getBoundingClientRect();n.modal.visible=!0,n.modal.colIndex=t.colIndex,n.modal.rowIndex=t.rowIndex,n.modal.parent=o.target,n.modal.top=e.top+e.height,n.modal.left=e.left,n.modal.width=r,n.modal.component=n.columns[t.colIndex].component}console.log(o.target)}return o},cellModified:o,textAlign:a,cellWidth:r,onFocus:function(e){i=e.target.innerText},onChange:function(e){e.target.innerHTML!==i&&(i=e.target.innerText,e.target.dispatchEvent(new Event("change")),o=!0),console.log("cellModified",o)},getIndent:function(e,t){return t&&0===e&&t>0?1*t+"ch":"inherit"}}}}),u=["contenteditable","innerHTML"];p.render=function(t,n,o,l,a,r){var i;return e.openBlock(),e.createElementBlock("td",{ref:"colIndex + ':' + rowIndex",contenteditable:!0===t.TableData.columns[t.colIndex].edit,tabindex:0,spellcheck:!1,style:e.normalizeStyle({"text-align":t.textAlign,width:t.cellWidth,"background-color":!1===t.cellModified?"inherit":"var(--cell-modified-color)","font-weight":!1===t.cellModified?"inherit":"bold","padding-left":t.getIndent(t.colIndex,null==(i=t.TableData.display[t.rowIndex])?void 0:i.indent)}),onFocus:n[0]||(n[0]=e=>t.onFocus(e)),onPaste:n[1]||(n[1]=e=>t.onChange(e)),onBlur:n[2]||(n[2]=e=>t.onChange(e)),onInput:n[3]||(n[3]=e=>t.onChange(e)),onKeydown:[n[4]||(n[4]=e.withKeys(((...e)=>t.$parent.$parent.enterNav&&t.$parent.$parent.enterNav(...e)),["enter"])),n[5]||(n[5]=e.withKeys(((...e)=>t.$parent.$parent.tabNav&&t.$parent.$parent.tabNav(...e)),["tab"])),n[6]||(n[6]=e.withKeys(((...e)=>t.$parent.$parent.endNav&&t.$parent.$parent.endNav(...e)),["end"])),n[7]||(n[7]=e.withKeys(((...e)=>t.$parent.$parent.homeNav&&t.$parent.$parent.homeNav(...e)),["home"])),n[8]||(n[8]=e.withKeys(((...e)=>t.$parent.$parent.downArrowNav&&t.$parent.$parent.downArrowNav(...e)),["down"])),n[9]||(n[9]=e.withKeys(((...e)=>t.$parent.$parent.upArrowNav&&t.$parent.$parent.upArrowNav(...e)),["up"])),n[10]||(n[10]=e.withKeys(((...e)=>t.$parent.$parent.leftArrowNav&&t.$parent.$parent.leftArrowNav(...e)),["left"])),n[11]||(n[11]=e.withKeys(((...e)=>t.$parent.$parent.rightArrowNav&&t.$parent.$parent.rightArrowNav(...e)),["right"]))],onClick:n[12]||(n[12]=(...e)=>t.handleInput&&t.handleInput(...e)),innerHTML:t.displayValue},null,44,u)},p.__scopeId="data-v-f81c70ec";const m=e.defineComponent({name:"ATableHeader",props:{columns:{type:Array,required:!0},config:{type:Object,default:()=>({})},tableid:{type:String,required:!0,default:()=>{}}},setup:t=>({TableData:e.inject(t.tableid)})}),f={key:0},w={tabindex:"-1"};m.render=function(t,n,o,l,a,r){return t.columns.length?(e.openBlock(),e.createElementBlock("thead",f,[e.createElementVNode("tr",w,[t.TableData.zeroColumn?(e.openBlock(),e.createElementBlock("th",{key:0,style:e.normalizeStyle({"min-width":t.TableData.numberedRowWidth})},null,4)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columns,((n,o)=>(e.openBlock(),e.createElementBlock("th",{key:o,tabindex:"-1",style:e.normalizeStyle({"text-align":void 0!==n.align?n.align.toLowerCase():"center","min-width":void 0!==n.width?n.width:"40ch"})},[e.renderSlot(t.$slots,"default",{},(()=>[e.createTextVNode(e.toDisplayString(void 0!==n.label?n.label:String.fromCharCode(o+97).toUpperCase()),1)]),!0)],4)))),128))])])):e.createCommentVNode("",!0)},m.__scopeId="data-v-bf1b4a04";const g=e.defineComponent({name:"ATableModal",props:{colIndex:{type:Number,required:!1,default:0},rowIndex:{type:Number,required:!1,default:0},tableid:{type:String,required:!1}},setup:t=>({TableData:e.inject(t.tableid),handleInput:function(e){e.stopPropagation()}})});g.render=function(t,n,o,l,a,r){return e.openBlock(),e.createElementBlock("div",{ref:"amodal",class:"amodal",tabindex:"-1",onClick:n[0]||(n[0]=(...e)=>t.handleInput&&t.handleInput(...e)),onInput:n[1]||(n[1]=(...e)=>t.handleInput&&t.handleInput(...e))},[e.renderSlot(t.$slots,"default",{},void 0,!0)],544)},g.__scopeId="data-v-5e464449";const h=e.defineComponent({name:"ATable",components:{ATableModal:g,ARow:s,ATableHeader:m,ACell:p},props:{columns:{type:Array,required:!0},rows:{type:Array,required:!1,default:()=>[]},config:{type:Object,default:()=>({})},tableid:{type:String,default:()=>{}}},setup(t){let n=new c(t.id,t.columns,t.rows,t.config);e.provide(n.id,n);function o(t){const o=t.target.cellIndex,l=t.target.parentElement.rowIndex,a=t.target.parentElement.parentElement;let r;a.rows.length!==l?(r=a.rows[l].cells[o],!0===n.config.treeView&&!1===n.display[l].open&&n.toggleRowExpand(l-1)):r=t.target,e.nextTick((function(){r.focus()}))}function l(t){const o=t.target.cellIndex,l=t.target.parentElement.rowIndex,a=t.target.parentElement.parentElement;let r;1!==l?(r=a.rows[l-2].cells[o],!0===n.config.treeView&&!1===n.display[l-2].open&&n.toggleRowExpand(n.display[l-2].parent)):r=t.target,e.nextTick((function(){r.focus()}))}function a(t){let o;const l=t.target.cellIndex,a=t.target.parentElement.rowIndex,r=t.target.parentElement.parentElement;r.rows[a-1].cells.length-1===l?r.rows.length===a?o=r.rows[0].cells[!0===n.zeroColumn?1:0]:(o=r.rows[a].cells[!0===n.zeroColumn?1:0],!0===n.config.treeView&&!1===n.display[a].open&&n.toggleRowExpand(a-1)):o=r.rows[a-1].cells[l+1],e.nextTick((function(){o.focus()}))}function r(e){let t;const o=e.target.cellIndex,l=e.target.parentElement.rowIndex,a=e.target.parentElement.parentElement;if(o===(!0===n.zeroColumn?1:0)){if(1===l)return;t=a.rows[l-2].cells[a.rows[l-2].cells.length-1],n.toggleRowExpand(l-2)}else t=a.rows[l-1].cells[o-1];t.focus()}return window.addEventListener("click",(function(e){if(n.modal.parent)if(n.modal.parent.contains(e.target));else{if(!n.modal.visible)return;n.modal.visible=!1}})),{TableData:n,v4:d,formatCell:function(e,t,o){let l;if(e?l=e.target.cellIndex+(!0===n.zeroColumn?-1:0):t&&o&&(l=n.columns.indexOf(t)),t||!("format"in n.columns[l]))return o&&"format"in t?t.format(o):(o&&t.type.toLowerCase(),o);e.target.innerHTML=n.columns[l].format(e.target.innerHTML)},enterNav:function(e){e.preventDefault(),e.stopPropagation(),!0===e.shiftKey?l(e):o(e)},tabNav:function(e){e.preventDefault(),e.stopPropagation(),!0===e.shiftKey?r(e):a(e)},downArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),o(e))},upArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),l(e))},leftArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),r(e))},rightArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),a(e))},homeNav:function(e){let t;const o=e.target.cellIndex,l=e.target.parentElement.rowIndex,a=e.target.parentElement.parentElement;o!==(!0===n.config.numberedRows?1:0)&&(t=a.rows[l-1].cells[!0===n.zeroColumn?1:0],t.focus())},endNav:function(e){let t;const o=e.target.cellIndex,l=e.target.parentElement.rowIndex,a=e.target.parentElement.parentElement;a.rows[l-1].cells.length-1!==o&&(t=a.rows[l-1].cells[n.columns.length-(!0===n.zeroColumn?0:1)],t.focus())},prevCell:r,nextCell:a,upCell:l,downCell:o,moveCursorToEnd:function(e){e.focus(),document.execCommand("selectAll",!1,null),document.getSelection().collapseToEnd()}}}}),b={class:"atable"};return h.render=function(t,n,o,l,a,r){const i=e.resolveComponent("ATableHeader"),d=e.resolveComponent("ACell"),c=e.resolveComponent("ARow"),s=e.resolveComponent("ATableModal");return e.openBlock(),e.createElementBlock("table",b,[e.renderSlot(t.$slots,"tableheader",{},(()=>[e.createVNode(i,{columns:t.TableData.columns,config:t.TableData.config,tableid:t.TableData.id},null,8,["columns","config","tableid"])]),!0),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.TableData.rows,((n,o)=>(e.openBlock(),e.createBlock(c,{key:n.id||t.v4(),row:n,rowIndex:o,tableid:t.TableData.id},{default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.TableData.columns,((n,l)=>(e.openBlock(),e.createBlock(d,{key:l,tableid:t.TableData.id,col:n,tabindex:"0",spellcheck:"false",rowIndex:o,colIndex:l+Number(!0===t.TableData.zeroColumn?0:-1),style:e.normalizeStyle({"text-align":void 0!==n.align?n.align.toLowerCase():"center","min-width":void 0!==n.width?n.width:"40ch"})},null,8,["tableid","col","rowIndex","colIndex","style"])))),128))])),_:2},1032,["row","rowIndex","tableid"])))),128))]),e.renderSlot(t.$slots,"footer",{},void 0,!0),e.withDirectives(e.createVNode(s,{colIndex:t.TableData.modal.colIndex,rowIndex:t.TableData.modal.rowIndex,tableid:t.TableData.id,style:e.normalizeStyle({left:t.TableData.modal.left+"px",top:t.TableData.modal.top+"px","max-width":t.TableData.modal.width+"px"})},{default:e.withCtx((()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.TableData.modal.component),{colIndex:t.TableData.modal.colIndex,rowIndex:t.TableData.modal.rowIndex,tableid:t.TableData.id},null,8,["colIndex","rowIndex","tableid"]))])),_:1},8,["colIndex","rowIndex","tableid","style"]),[[e.vShow,t.TableData.modal.visible]])])},h.__scopeId="data-v-455a3966",{install:function(e,t){e.component("ATable",h),e.component("ATableHeader",m),e.component("ATableModal",g)}}}));
