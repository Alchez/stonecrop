import{reactive as e,ref as t,computed as n,defineComponent as o,inject as a,withDirectives as l,openBlock as r,createBlock as d,toDisplayString as i,createCommentVNode as s,renderSlot as c,vShow as p,watch as u,resolveDynamicComponent as f,shallowRef as m,withKeys as g,withScopeId as w,pushScopeId as b,popScopeId as h,createVNode as x,Fragment as v,renderList as I,createTextVNode as y,provide as T,nextTick as $,resolveComponent as D}from"vue";var C,E=new Uint8Array(16);function A(){if(!C&&!(C="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return C(E)}var R=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function N(e){return"string"==typeof e&&R.test(e)}for(var k=[],O=0;O<256;++O)k.push((O+256).toString(16).substr(1));function V(e,t,n){var o=(e=e||{}).random||(e.rng||A)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=o[a];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]).toLowerCase();if(!N(n))throw TypeError("Stringified UUID is invalid");return n}(o)}class M{constructor(n,o=[],a=[],l={},r,d){this.id=void 0===n?V():n,this.rows=a,this.columns=e(o),this.config=e(l),this.table=void 0===r?e(this.createTableObject()):r,this.display=this.createDisplayObject(d),this.modal=e({visible:!1,rowIndex:void 0,colIndex:void 0,event:t(V()),top:void 0,left:void 0,width:void 0})}createTableObject(){let e={};for(const[t,n]of this.columns.entries())for(const[o,a]of this.rows.entries())e[`${t}:${o}`]=a[n.name];return e}createDisplayObject(t){let n={modified:!1};if(void 0!==t&&t.hasOwnProperty("0:0"))return t;void 0!==t&&t.hasOwnProperty("default")&&(n=t.default);let o=new Set;for(let e=this.rows.length-1;e>=0;e--){let t=this.rows[e];t.parent&&o.add(t.parent),n[e]={modified:!1,open:null===t.parent||void 0===t.parent,isParent:!!o.has(e),parent:t.parent,isRoot:null===t.parent||void 0===t.parent,indent:t.indent||null,childrenOpen:!1}}return e(n)}get zeroColumn(){return!(!this.config.numberedRows&&!this.config.treeView)}get numberedRowWidth(){n((()=>String(Math.ceil(this.rows.length/100)+1)+"ch"))}cellData(e,t){return this.table[`${e}:${t}`]}setCellData(e,t,n){return this.table[`${t}:${e}`]!==n&&(this.display[`${t}:${e}`].modified=!0),this.table[`${t}:${e}`]=n,this.table[`${t}:${e}`]}toggleRowExpand(e){if(this.config.treeView){this.display[e].childrenOpen=!this.display[e].childrenOpen;for(let t=this.rows.length-1;t>=0;t--)this.display[t].parent===e&&(this.display[t].open=!this.display[t].open,this.display[t].childrenOpen&&this.toggleRowExpand(t))}}}const P=o({name:"ARow",props:{row:{type:Object,required:!0,default:()=>({})},rowIndex:{type:Number,required:!0,default:0},tableid:{type:String,required:!0,default:()=>{}}},setup(e,t){const n=a(e.tableid);return{TableData:n,getRowExpandSymbol:function(){return n.config.treeView?n.display[e.rowIndex].isRoot&&!n.display[e.rowIndex].childrenOpen?"+":n.display[e.rowIndex].isRoot&&n.display[e.rowIndex].childrenOpen?"-":n.display[e.rowIndex].isParent&&!n.display[e.rowIndex].childrenOpen?"+":n.display[e.rowIndex].isParent&&n.display[e.rowIndex].childrenOpen?"-":"":""},toggleRowExpand:function(e){n.toggleRowExpand(e)},rowVisible:function(){return!n.config.treeView||(!!n.display[e.rowIndex].isRoot||n.display[e.rowIndex].open)}}}});P.render=function(e,t,n,o,a,u){return l((r(),d("tr",null,[e.TableData.config.numberedRows?(r(),d("td",{key:0,style:{width:"TableData.numberedRowWidth","text-align":"center","background-color":"var(--brand-color)",color:"var(--header-text-color)","font-weight":"bold","border-color":"var(--header-border-color)","user-select":"none"}},i(e.rowIndex+1),5)):s("",!0),e.TableData.config.treeView?(r(),d("td",{key:1,style:{width:"2ch","text-align":"center","background-color":"var(--brand-color)",color:"var(--header-text-color)","font-weight":"bold","border-color":"var(--header-border-color)","user-select":"none"},onClick:t[1]||(t[1]=t=>e.toggleRowExpand(e.rowIndex))},i(e.getRowExpandSymbol()),5)):s("",!0),e.TableData.config.numberedRows||e.TableData.config.treeView?s("",!0):c(e.$slots,"indexCell",{key:2}),c(e.$slots,"default")],512)),[[p,e.rowVisible()]])};const S=o({name:"ACell",props:{colIndex:{type:Number,required:!0,default:0},rowIndex:{type:Number,required:!0,default:0},tableid:{type:String,required:!0,default:()=>{}}},setup(e,o){const l=a(e.tableid);let r=t(!1);const d=n((()=>void 0!==l.columns[e.colIndex].format?l.columns[e.colIndex].format(l.cellData(e.colIndex,e.rowIndex)):l.cellData(e.colIndex,e.rowIndex))),i=n((()=>void 0!==l.columns[e.colIndex].align?l.columns[e.colIndex].align.toLowerCase():"center")),s=n((()=>void 0!==l.columns[e.colIndex].width?l.columns[e.colIndex].width:"40ch"));let c="";return u(r,(()=>{console.log(c)})),{TableData:l,updateData:function(t){t&&(void 0===l.columns[e.colIndex].component&&l.setCellData(e.rowIndex,e.colIndex,t.target.innerHTML),r=!0)},displayValue:d,handleInput:function(t){if(void 0!==l.columns[e.colIndex].mask&&console.log("masking function"),l.columns[e.colIndex].hasOwnProperty("component")&&f(l.columns[e.colIndex].component)){const n=t.target.getBoundingClientRect();l.modal.component=m(this.$root.$.appContext.components[l.columns[e.colIndex].component]),l.modal.visible=!0,l.modal.colIndex=e.colIndex,l.modal.rowIndex=e.rowIndex,l.modal.event=V(),l.modal.parent=t.target,l.modal.top=n.top+n.height,l.modal.left=n.left,l.modal.width=s}return t},cellModified:r,textAlign:i,cellWidth:s,onFocus:function(e){c=e.target.innerText},onChange:function(e){e.target.innerHTML!==c&&(c=e.target.innerText,e.target.dispatchEvent(new Event("change")),r=!0),console.log("cellModified",r)},getIndent:function(e,t){return t&&0===e&&t>0?1*t+"ch":"inherit"}}}}),q=w("data-v-6951443b")(((e,t,n,o,a,l)=>{var i;return r(),d("td",{ref:"colIndex + ':' + rowIndex",contenteditable:!0===e.TableData.columns[e.colIndex].edit,tabindex:0,spellcheck:!1,style:{"text-align":e.textAlign,width:e.cellWidth,"background-color":!1===e.cellModified?"inherit":"var(--cell-modified-color)","font-weight":!1===e.cellModified?"inherit":"bold","padding-left":e.getIndent(e.colIndex,null==(i=e.TableData.display[e.rowIndex])?void 0:i.indent)},onFocus:t[1]||(t[1]=t=>e.onFocus(t)),onPaste:t[2]||(t[2]=t=>e.onChange(t)),onBlur:t[3]||(t[3]=t=>e.onChange(t)),onInput:t[4]||(t[4]=t=>e.onChange(t)),onKeydown:[t[5]||(t[5]=g(((...t)=>e.$parent.$parent.enterNav&&e.$parent.$parent.enterNav(...t)),["enter"])),t[6]||(t[6]=g(((...t)=>e.$parent.$parent.tabNav&&e.$parent.$parent.tabNav(...t)),["tab"])),t[7]||(t[7]=g(((...t)=>e.$parent.$parent.endNav&&e.$parent.$parent.endNav(...t)),["end"])),t[8]||(t[8]=g(((...t)=>e.$parent.$parent.homeNav&&e.$parent.$parent.homeNav(...t)),["home"])),t[9]||(t[9]=g(((...t)=>e.$parent.$parent.downArrowNav&&e.$parent.$parent.downArrowNav(...t)),["down"])),t[10]||(t[10]=g(((...t)=>e.$parent.$parent.upArrowNav&&e.$parent.$parent.upArrowNav(...t)),["up"])),t[11]||(t[11]=g(((...t)=>e.$parent.$parent.leftArrowNav&&e.$parent.$parent.leftArrowNav(...t)),["left"])),t[12]||(t[12]=g(((...t)=>e.$parent.$parent.rightArrowNav&&e.$parent.$parent.rightArrowNav(...t)),["right"]))],onClick:t[13]||(t[13]=(...t)=>e.handleInput&&e.handleInput(...t)),innerHTML:e.displayValue},null,44,["contenteditable","innerHTML"])}));S.render=q,S.__scopeId="data-v-6951443b";const L=o({name:"ATableHeader",props:{columns:{type:Array,required:!0},config:{type:Object,default:()=>({})},tableid:{type:String,required:!0,default:()=>{}}},setup:(e,t)=>({TableData:a(e.tableid)})}),H=w("data-v-28265d49");b("data-v-28265d49");const _={key:0},z={tabindex:"-1"};h();const j=H(((e,t,n,o,a,l)=>e.columns.length?(r(),d("thead",_,[x("tr",z,[e.TableData.zeroColumn?(r(),d("th",{key:0,style:{"min-width":e.TableData.numberedRowWidth}},null,4)):s("",!0),(r(!0),d(v,null,I(e.columns,((t,n)=>(r(),d("th",{key:n,tabindex:"-1",style:{"text-align":void 0!==t.align?t.align.toLowerCase():"center","min-width":void 0!==t.width?t.width:"40ch"}},[c(e.$slots,"default",{},(()=>[y(i(void 0!==t.label?t.label:String.fromCharCode(n+97).toUpperCase()),1)]),{},!0)],4)))),128))])])):s("",!0)));L.render=j,L.__scopeId="data-v-28265d49";const K=o({name:"ATableModal",props:{event:{type:String,required:!1},colIndex:{type:Number,required:!1,default:0},rowIndex:{type:Number,required:!1,default:0},tableid:{type:String,required:!1,default:()=>{}}},setup(e,n){const o=a(e.tableid);let l=t({left:0,top:0,width:0});function r(e){o.modal.parent.contains(e.target)?(console.log("click outside"),o.modal.visible=!1):e.stopPropagation(),e.target.blur()}return u(o.modal,(()=>{console.log(o.modal),window.addEventListener("click",r)})),{TableData:o,handleInput:function(e){e.stopPropagation()},modal:l}}}),W=w("data-v-21e34a7a")(((e,t,n,o,a,i)=>l((r(),d("div",{ref:"amodal",class:"amodal",style:{left:e.modal.left,top:e.modal.top,width:e.modal.width},tabindex:"-1",onClick:t[1]||(t[1]=(...t)=>e.handleInput&&e.handleInput(...t)),onInput:t[2]||(t[2]=(...t)=>e.handleInput&&e.handleInput(...t))},[c(e.$slots,"default",{},void 0,!0)],36)),[[p,e.TableData.modal.visible]])));K.render=W,K.__scopeId="data-v-21e34a7a";const U=o({name:"ATable",components:{ATableModal:K,ARow:P,ATableHeader:L,ACell:S},props:{columns:{type:Array,required:!0},rows:{type:Array,required:!1,default:()=>[]},config:{type:Object,default:()=>({})},tableid:{type:String,default:()=>{}}},setup(e,n){let o=new M(e.id,e.columns,e.rows,e.config);T(o.id,o);function a(e){const t=e.target.cellIndex,n=e.target.parentElement.rowIndex,a=e.target.parentElement.parentElement;let l;a.rows.length!==n?(l=a.rows[n].cells[t],!0===o.config.treeView&&!1===o.display[n].open&&o.toggleRowExpand(n-1)):l=e.target,$((function(){l.focus()}))}function l(e){const t=e.target.cellIndex,n=e.target.parentElement.rowIndex,a=e.target.parentElement.parentElement;let l;1!==n?(l=a.rows[n-2].cells[t],!0===o.config.treeView&&!1===o.display[n-2].open&&o.toggleRowExpand(o.display[n-2].parent)):l=e.target,$((function(){l.focus()}))}function r(e){let t;const n=e.target.cellIndex,a=e.target.parentElement.rowIndex,l=e.target.parentElement.parentElement;l.rows[a-1].cells.length-1===n?l.rows.length===a?t=l.rows[0].cells[!0===o.zeroColumn?1:0]:(t=l.rows[a].cells[!0===o.zeroColumn?1:0],!0===o.config.treeView&&!1===o.display[a].open&&o.toggleRowExpand(a-1)):t=l.rows[a-1].cells[n+1],$((function(){t.focus()}))}function d(e){let t;const n=e.target.cellIndex,a=e.target.parentElement.rowIndex,l=e.target.parentElement.parentElement;if(n===(!0===o.zeroColumn?1:0)){if(1===a)return;t=l.rows[a-2].cells[l.rows[a-2].cells.length-1],o.toggleRowExpand(a-2)}else t=l.rows[a-1].cells[n-1];t.focus()}var i=t({event:void 0,colIndex:void 0,rowIndex:void 0,component:"",tableid:o.id});return{TableData:o,v4:V,formatCell:function(e,t,n){let a;if(e?a=e.target.cellIndex+(!0===o.zeroColumn?-1:0):t&&n&&(a=o.columns.indexOf(t)),t||!("format"in o.columns[a]))return n&&"format"in t?t.format(n):(n&&t.type.toLowerCase(),n);e.target.innerHTML=o.columns[a].format(e.target.innerHTML)},enterNav:function(e){e.preventDefault(),e.stopPropagation(),!0===e.shiftKey?l(e):a(e)},tabNav:function(e){e.preventDefault(),e.stopPropagation(),!0===e.shiftKey?d(e):r(e)},downArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),a(e))},upArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),l(e))},leftArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),d(e))},rightArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),r(e))},homeNav:function(e){let t;const n=e.target.cellIndex,a=e.target.parentElement.rowIndex,l=e.target.parentElement.parentElement;n!==(!0===o.config.numberedRows?1:0)&&(t=l.rows[a-1].cells[!0===o.zeroColumn?1:0],t.focus())},endNav:function(e){let t;const n=e.target.cellIndex,a=e.target.parentElement.rowIndex,l=e.target.parentElement.parentElement;l.rows[a-1].cells.length-1!==n&&(t=l.rows[a-1].cells[o.columns.length-(!0===o.zeroColumn?0:1)],t.focus())},prevCell:d,nextCell:r,upCell:l,downCell:a,moveCursorToEnd:function(e){e.focus(),document.execCommand("selectAll",!1,null),document.getSelection().collapseToEnd()},modal:i}}}),F=w("data-v-601b76de");b("data-v-601b76de");const B={class:"atable"};h();const G=F(((e,t,n,o,a,l)=>{const i=D("ATableHeader"),s=D("ACell"),p=D("ARow"),u=D("ATableModal");return r(),d("table",B,[c(e.$slots,"tableheader",{},(()=>[x(i,{columns:e.TableData.columns,config:e.TableData.config,tableid:e.TableData.id},null,8,["columns","config","tableid"])]),{},!0),x("tbody",null,[(r(!0),d(v,null,I(e.TableData.rows,((t,n)=>(r(),d(p,{key:t.id||e.v4(),row:t,rowIndex:n,tableid:e.TableData.id},{default:F((()=>[(r(!0),d(v,null,I(e.TableData.columns,((t,o)=>(r(),d(s,{key:o,tableid:e.TableData.id,col:t,tabindex:"0",spellcheck:"false",rowIndex:n,colIndex:o+Number(!0===e.TableData.zeroColumn?0:-1),style:{"text-align":void 0!==t.align?t.align.toLowerCase():"center","min-width":void 0!==t.width?t.width:"40ch"}},null,8,["tableid","col","rowIndex","colIndex","style"])))),128))])),_:2},1032,["row","rowIndex","tableid"])))),128))]),c(e.$slots,"footer",{},void 0,!0),x(u,{colIndex:e.TableData.modal.colIndex,rowIndex:e.TableData.modal.rowIndex,event:e.TableData.modal.event,tableid:e.TableData.id,style:{"{border":"1px solid var(--brand-color)"}},{default:F((()=>[(r(),d(f(e.TableData.modal.component),{colIndex:e.TableData.modal.colIndex,rowIndex:e.TableData.modal.rowIndex,event:e.TableData.modal.event,tableid:e.TableData.id},null,8,["colIndex","rowIndex","event","tableid"]))])),_:1},8,["colIndex","rowIndex","event","tableid"])])}));U.render=G,U.__scopeId="data-v-601b76de";var J={install:function(e,t){e.component("ATable",U),e.component("ATableHeader",L),e.component("ATableModal",K)}};export{J as default};
