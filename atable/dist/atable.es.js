import{reactive as e,ref as t,computed as n,defineComponent as o,inject as a,withDirectives as r,openBlock as l,createBlock as i,toDisplayString as d,createCommentVNode as s,renderSlot as c,vShow as p,watch as u,resolveDynamicComponent as f,withKeys as m,pushScopeId as g,popScopeId as w,createVNode as h,Fragment as b,renderList as v,createTextVNode as x,withScopeId as y,provide as I,nextTick as T,resolveComponent as D}from"vue";var $,C=new Uint8Array(16);function E(){if(!$&&!($="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $(C)}var A=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function R(e){return"string"==typeof e&&A.test(e)}for(var N=[],k=0;k<256;++k)N.push((k+256).toString(16).substr(1));function V(e,t,n){var o=(e=e||{}).random||(e.rng||E)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=o[a];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(N[e[t+0]]+N[e[t+1]]+N[e[t+2]]+N[e[t+3]]+"-"+N[e[t+4]]+N[e[t+5]]+"-"+N[e[t+6]]+N[e[t+7]]+"-"+N[e[t+8]]+N[e[t+9]]+"-"+N[e[t+10]]+N[e[t+11]]+N[e[t+12]]+N[e[t+13]]+N[e[t+14]]+N[e[t+15]]).toLowerCase();if(!R(n))throw TypeError("Stringified UUID is invalid");return n}(o)}class P{constructor(t,n=[],o=[],a={},r,l){this.id=void 0===t?V():t,this.rows=o,this.columns=e(n),this.config=e(a),this.table=void 0===r?e(this.createTableObject(o)):r,this.display=this.createDisplayObject(l),this.modal=e({visible:!1,rowIndex:void 0,colIndex:void 0,event:void 0})}createTableObject(e){let t={};return this.columns.forEach(((n,o)=>{e.forEach(((n,a)=>{t[o+":"+a]=e[a][this.columns[o].name]}))})),t}createDisplayObject(e){let n={};return n=!0===this.config.treeView?{modified:t(!1),open:t(!1),isParent:!1,isRoot:!1}:{modified:!1},void 0!==e&&e.hasOwnProperty("0:0")||(void 0!==e&&e.hasOwnProperty("default")&&(n=e.default),e={},Object.keys(this.table).forEach((t=>{e[t]=n}))),e}get zeroColumn(){return!(!this.config.numberedRows&&!this.config.treeView)}get numberedRowWidth(){n((()=>String(Math.ceil(this.rows.length/100)+1)+"ch"))}cellData(e,t){return this.table[t+":"+e]}setCellData(e,t,n){return this.table[t+":"+e]!==n&&(this.display[t+":"+e].modified=!0),this.table[t+":"+e]=n,this.table[t+":"+e]}}const q=o({name:"ARow",props:{row:{type:Object,required:!0,default:()=>({})},rowIndex:{type:Number,required:!0,default:0},isParent:{type:Boolean,default:!1},tableid:{type:String,required:!0,default:()=>{}}},setup:(e,n)=>({open:t(!1),TableData:a(e.tableid),getRowExpandSymbol:function(){return this.isParent&&!this.open?"+":this.isParent&&this.open?"-":""},toggleRowExpand:function(e,t){this.open?this.$parent.toggleRowCollapseDeep(e,t):this.$parent.toggleRowExpand(e,t),this.open=!this.open}})});q.render=function(e,t,n,o,a,u){return r((l(),i("tr",null,[e.TableData.config.numberedRows?(l(),i("td",{key:0,style:{width:"TableData.numberedRowWidth","text-align":"center","background-color":"var(--brand-color)",color:"var(--header-text-color)","font-weight":"bold","border-color":"var(--header-border-color)","user-select":"none"}},d(e.rowIndex+1),5)):s("",!0),e.TableData.config.treeView?(l(),i("td",{key:1,style:{width:"2ch","text-align":"center","background-color":"var(--brand-color)",color:"var(--header-text-color)","font-weight":"bold","border-color":"var(--header-border-color)","user-select":"none"},onClick:t[1]||(t[1]=t=>e.toggleRowExpand(t,e.rowIndex))},d(e.getRowExpandSymbol()),5)):s("",!0),e.TableData.config.numberedRows||e.TableData.config.treeView?s("",!0):c(e.$slots,"indexCell",{key:2}),c(e.$slots,"default")],512)),[[p,!e.TableData.config.treeView||e.$parent.rowExpand(e.rowIndex)]])};const M=o({name:"ACell",props:{colIndex:{type:Number,required:!0,default:0},rowIndex:{type:Number,required:!0,default:0},tableid:{type:String,required:!0,default:()=>{}}},setup(e,o){const r=a(e.tableid);let l=t(!1);const i=n((t=>void 0!==r.columns[e.colIndex].format?r.columns[e.colIndex].format(r.cellData(e.rowIndex,e.colIndex)):r.cellData(e.rowIndex,e.colIndex))),d=n((()=>void 0!==r.columns[e.colIndex].align?r.columns[e.colIndex].align.toLowerCase():"center")),s=n((()=>void 0!==r.columns[e.colIndex].width?r.columns[e.colIndex].width:"40ch"));let c="";return u(l,(()=>{console.log(c)})),{TableData:r,updateData:function(t){t&&(void 0===r.columns[e.colIndex].component&&r.setCellData(e.rowIndex,e.colIndex,t.target.innerHTML),l=!0)},displayValue:i,handleInput:function(t){return void 0!==r.columns[e.colIndex].mask&&console.log("masking function"),r.columns[e.colIndex].hasOwnProperty("component")&&f(r.columns[e.colIndex].component)&&(r.modal.component=this.$root.$.appContext.components[r.columns[e.colIndex].component],r.modal.visible=!0,r.modal.colIndex=e.colIndex,r.modal.rowIndex=e.rowIndex,r.modal.event=t,r.modal.parent=this),t},cellModified:l,textAlign:d,cellWidth:s,onFocus:function(e){c=e.target.innerText},onChange:function(e){e.target.innerHTML!==c&&(c=e.target.innerText,e.target.dispatchEvent(new Event("change")),l=!0)}}}});M.render=function(e,t,n,o,a,r){return l(),i("td",{ref:"colIndex + ':' + rowIndex",contenteditable:!0===e.TableData.columns[e.colIndex].edit,tabindex:0,spellcheck:!1,style:{"text-align":e.textAlign,width:e.cellWidth,"background-color":!1===e.cellModified?"inherit":"var(--cell-modified-color)","font-weight":!1===e.cellModified?"inherit":"bold"},onFocus:t[1]||(t[1]=t=>e.onFocus(t)),onPaste:t[2]||(t[2]=t=>e.onChange(t)),onBlur:t[3]||(t[3]=t=>e.onChange(t)),onInput:t[4]||(t[4]=t=>e.onChange(t)),onKeydown:[t[5]||(t[5]=m(((...t)=>e.$parent.$parent.enterNav&&e.$parent.$parent.enterNav(...t)),["enter"])),t[6]||(t[6]=m(((...t)=>e.$parent.$parent.tabNav&&e.$parent.$parent.tabNav(...t)),["tab"])),t[7]||(t[7]=m(((...t)=>e.$parent.$parent.endNav&&e.$parent.$parent.endNav(...t)),["end"])),t[8]||(t[8]=m(((...t)=>e.$parent.$parent.homeNav&&e.$parent.$parent.homeNav(...t)),["home"])),t[9]||(t[9]=m(((...t)=>e.$parent.$parent.downArrowNav&&e.$parent.$parent.downArrowNav(...t)),["down"])),t[10]||(t[10]=m(((...t)=>e.$parent.$parent.upArrowNav&&e.$parent.$parent.upArrowNav(...t)),["up"])),t[11]||(t[11]=m(((...t)=>e.$parent.$parent.leftArrowNav&&e.$parent.$parent.leftArrowNav(...t)),["left"])),t[12]||(t[12]=m(((...t)=>e.$parent.$parent.rightArrowNav&&e.$parent.$parent.rightArrowNav(...t)),["right"]))],onClick:t[13]||(t[13]=(...t)=>e.handleInput&&e.handleInput(...t)),innerHTML:e.displayValue},null,44,["contenteditable","innerHTML"])};const O=o({name:"ATableHeader",props:{columns:{type:Array,required:!0},config:{type:Object,default:()=>({})},tableid:{type:String,required:!0,default:()=>{}}},setup:(e,t)=>({TableData:a(e.tableid)})}),S=y("data-v-16118e24");g("data-v-16118e24");const L={key:0},H={tabindex:"-1"};w();const j=S(((e,t,n,o,a,r)=>e.columns.length?(l(),i("thead",L,[h("tr",H,[e.TableData.zeroColumn?(l(),i("th",{key:0,style:{"min-width":e.TableData.numberedRowWidth}},null,4)):s("",!0),(l(!0),i(b,null,v(e.columns,((t,n)=>(l(),i("th",{key:n,tabindex:"-1",style:{"text-align":void 0!==t.align?t.align.toLowerCase():"center","min-width":void 0!==t.width?t.width:"40ch"}},[c(e.$slots,"default",{},(()=>[x(d(void 0!==t.label?t.label:String.fromCharCode(n+97).toUpperCase()),1)]),{},!0)],4)))),128))])])):s("",!0)));O.render=j,O.__scopeId="data-v-16118e24";const z=o({name:"ATable",components:{ARow:q,ATableHeader:O,ACell:M},props:{columns:{type:Array,required:!0},rows:{type:Array,required:!1,default:()=>[]},config:{type:Object,default:()=>({})},tableid:{type:String,default:()=>{}}},setup(e,n){let o=t([]),a=new P(e.id,e.columns,e.rows,e.config);!0===a.config.treeView&&a.rows.forEach(((e,t)=>{o.push({open:!1,isParent:!1,isRoot:null===e.parent||void 0===e.parent}),null!==e.parent&&void 0!==e.parent&&(o[e.parent].isParent=!0)})),I(a.id,a);const r=function(e,t){a.config.treeView&&a.rows.forEach(((n,a)=>{n.parent===t&&(o[a].isParent&&r(e,a),o[a].open=!1)}))},l=function(e,t){a.rows.forEach(((e,n)=>{e.parent===t&&(o[n].open=!o[n].open)}))};function i(e){const t=e.target.cellIndex,n=e.target.parentElement.rowIndex,r=e.target.parentElement.parentElement;let i;r.rows.length!==n?(i=r.rows[n].cells[t],!0===a.config.treeView&&!1===o[n].open&&l(e,n-1)):i=e.target,T((function(){i.focus()}))}function d(e){const t=e.target.cellIndex,n=e.target.parentElement.rowIndex,r=e.target.parentElement.parentElement;let i;1!==n?(i=r.rows[n-2].cells[t],!0===a.config.treeView&&!1===o[n-2].open&&l(e,a.rows[n-2].parent)):i=e.target,T((function(){i.focus()}))}function s(e){let t;const n=e.target.cellIndex,r=e.target.parentElement.rowIndex,i=e.target.parentElement.parentElement;i.rows[r-1].cells.length-1===n?i.rows.length===r?t=i.rows[0].cells[!0===a.zeroColumn?1:0]:(t=i.rows[r].cells[!0===a.zeroColumn?1:0],!0===a.config.treeView&&!1===o[r].open&&l(e,r-1)):t=i.rows[r-1].cells[n+1],T((function(){t.focus()}))}function c(e){let t;const n=e.target.cellIndex,o=e.target.parentElement.rowIndex,r=e.target.parentElement.parentElement;if(n===(!0===a.zeroColumn?1:0)){if(1===o)return;t=r.rows[o-2].cells[r.rows[o-2].cells.length-1],l(e,o-2)}else t=r.rows[o-1].cells[n-1];t.focus()}var p=t({event:void 0,colIndex:void 0,rowIndex:void 0,component:"",tableid:a.id});return{TableData:a,displayRows:o,formatCell:function(e,t,n){let o;if(e?o=e.target.cellIndex+(!0===a.zeroColumn?-1:0):t&&n&&(o=a.columns.indexOf(t)),t||!("format"in a.columns[o]))return n&&"format"in t?t.format(n):(n&&t.type.toLowerCase(),n);e.target.innerHTML=a.columns[o].format(e.target.innerHTML)},getIndent:function(e,t){return t&&0===e&&t>0?1*t+"ch":null},rowExpand:function(e){return o[e].isRoot||o[e].open},toggleRowExpand:l,toggleRowExpandDeep:function(e,t){l(e,t)},toggleRowCollapseDeep:r,enterNav:function(e){e.preventDefault(),e.stopPropagation(),!0===e.shiftKey?d(e):i(e)},tabNav:function(e){e.preventDefault(),e.stopPropagation(),!0===e.shiftKey?c(e):s(e)},downArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),i(e))},upArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),d(e))},leftArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),c(e))},rightArrowNav:function(e){!0!==e.shiftKey&&(e.preventDefault(),e.stopPropagation(),s(e))},homeNav:function(e){let t;const n=e.target.cellIndex,o=e.target.parentElement.rowIndex,r=e.target.parentElement.parentElement;n!==(!0===a.config.numberedRows?1:0)&&(t=r.rows[o-1].cells[!0===a.zeroColumn?1:0],t.focus())},endNav:function(e){let t;const n=e.target.cellIndex,o=e.target.parentElement.rowIndex,r=e.target.parentElement.parentElement;r.rows[o-1].cells.length-1!==n&&(t=r.rows[o-1].cells[a.columns.length-(!0===a.zeroColumn?0:1)],t.focus())},prevCell:c,nextCell:s,upCell:d,downCell:i,moveCursorToEnd:function(e){e.focus(),document.execCommand("selectAll",!1,null),document.getSelection().collapseToEnd()},modal:p}}}),_=y("data-v-601dd5f4");g("data-v-601dd5f4");const K={class:"atable"};w();const W=_(((e,t,n,o,a,r)=>{const d=D("ATableHeader"),s=D("ACell"),p=D("ARow"),u=D("ATableModal");return l(),i("table",K,[c(e.$slots,"tableheader",{},(()=>[h(d,{columns:e.TableData.columns,config:e.TableData.config,tableid:e.TableData.id},null,8,["columns","config","tableid"])]),{},!0),h("tbody",null,[(l(!0),i(b,null,v(e.TableData.rows,((t,n)=>(l(),i(p,{key:t.id,row:t,"row-index":n,"is-parent":!0===e.TableData.config.treeView?e.displayRows[n].isParent:null,"is-open":!0===e.TableData.config.treeView?e.displayRows[n].open:null,tableid:e.TableData.id},{default:_((()=>[(l(!0),i(b,null,v(e.TableData.columns,((t,o)=>(l(),i(s,{key:o,tableid:e.TableData.id,col:t,tabindex:"0",spellcheck:"false","row-index":n,"col-index":o+Number(!0===e.TableData.zeroColumn?0:-1),style:{"text-align":void 0!==t.align?t.align.toLowerCase():"center","min-width":void 0!==t.width?t.width:"40ch","padding-left":e.getIndent(o,e.TableData.rows[n].indent)}},null,8,["tableid","col","row-index","col-index","style"])))),128))])),_:2},1032,["row","row-index","is-parent","is-open","tableid"])))),128))]),c(e.$slots,"footer",{},void 0,!0),h(u,{colIndex:e.TableData.modal.colIndex,rowIndex:e.TableData.modal.rowIndex,event:e.TableData.modal.event,tableid:e.TableData.id,style:{"{border":"1px solid var(--brand-color)"}},{default:_((()=>[(l(),i(f(e.TableData.modal.component),{colIndex:e.TableData.modal.colIndex,rowIndex:e.TableData.modal.rowIndex,event:e.TableData.modal.event,tableid:e.TableData.id},null,8,["colIndex","rowIndex","event","tableid"]))])),_:1},8,["colIndex","rowIndex","event","tableid"])])}));z.render=W,z.__scopeId="data-v-601dd5f4";const U={name:"ATableModal",props:{event:{type:MouseEvent,required:!1},colIndex:{type:Number,required:!1,default:0},rowIndex:{type:Number,required:!1,default:0},tableid:{type:String,required:!1,default:()=>{}}},data:()=>({modal:{left:"",top:"",width:"",parent:""},isVisible:!1}),methods:{handleInput(e){e.stopPropagation()},clickOutside(e){console.log("click outside"),this.modal.parent.contains(e.target)?e.stopPropagation():(console.log("click outside"),this.isVisible=!1),e.target.blur()}},watch:{event(){if(console.log("event",this.$props.event),void 0!==this.$props.event){this.isVisible=!0;const e=this.$props.event.target.getBoundingClientRect();this.modal.left=e.left+"px",this.modal.top=e.top+e.height+"px",this.modal.width=e.width+"px",this.modal.parent=this.$props.event.target,window.addEventListener("click",this.clickOutside)}}}},B=y("data-v-8ff36780")(((e,t,n,o,a,d)=>r((l(),i("div",{ref:"amodal",class:"amodal",style:{left:a.modal.left,top:a.modal.top,width:a.modal.width},tabindex:"-1",onClick:t[1]||(t[1]=(...e)=>d.handleInput&&d.handleInput(...e)),onInput:t[2]||(t[2]=(...e)=>d.handleInput&&d.handleInput(...e))},[c(e.$slots,"default",{},void 0,!0)],36)),[[p,a.isVisible]])));U.render=B,U.__scopeId="data-v-8ff36780";var F={install:function(e,t){e.component("ATable",z),e.component("ATableHeader",O),e.component("ATableModal",U)}};export{F as default};
